# 网络象棋 desu

## 架构

服务器为内嵌服务器，一个客户端启动服务器后等待另一个客户端的连接，另一个客户端输入连接地址后服务器执行初始化。启动服务器一方直接通过事件与服务器通讯，另一方通过TCP通讯。

客户端本身不更新棋局状态，只向服务器提交更新，由服务器更新状态后下发给双方。流程如下:

- 客户端接受用户输入：移动棋子、头像、加载棋局
- 客户端打包请求发送至服务器，具体见 src/proto/msg.proto 中 Request 数据结构
- 服务器收到请求，更新内部状态
- 服务器向客户端发送一个或多个更新，具体见 src/proto/msg.proto 中 Sync 数据结构，更新内容可能包括
  - 一方胜利以及胜利原因
  - 棋盘更新
  - 执棋方变化，通常与棋盘更新同时发生
- 客户端更新UI

## 用户UI
首先，用户可以通过菜单栏启动本地服务器，或者连接到另一个服务器。交战双方都完成连接后棋局立即开始。

棋局开始后，执棋方计时器显示该步剩余秒数，另一方显示 9999。计时器下方显示当前棋局状态，即执棋方与是否有人获胜。

执棋方可以点击棋盘上己方棋子，之后会出现半透明的棋子表示可以移动到的位置。点击其他棋子可以改变目前选中的棋子。点击虚影可以完成一步棋。

双方在棋局进行中的任何时候都可以点击左侧的三个按钮，执行以下功能：

- 认输
- 加载棋局，弹出一个对话框，可以选择保存文件
- 保存棋局，弹出一个对话框，可以选择保存的位置

当有任意棋盘更新发生后，某一方被将军，即另一方可以在下一步将其将吃掉，该方会触发系统的提示音。

当任意一方胜利，双方会弹出对话框，标记胜利方和胜利原因。胜利原因见下方胜利条件一节。之后，用户可以重新启动服务器或者连接到另一服务器。

## 胜利条件
- 一方超时，如果连接断开，服务器仍然会计时
- 一方认输
- 一方的将被吃掉
